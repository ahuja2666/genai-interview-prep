
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Interview Simulator</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            color: #333;
        }
        .container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-top: 20px;
        }
        h1 {
            color: #2c3e50;
        }
        textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            resize: vertical;
            margin-bottom: 10px;
            font-family: inherit;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #2980b9;
        }
        button:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
        .interview-area {
            display: none;
            margin-top: 20px;
        }
        .feedback-area {
            display: none;
            margin-top: 20px;
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 4px;
        }
        .question {
            font-size: 18px;
            margin-bottom: 20px;
            font-weight: 500;
        }
        .controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        .status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            display: none;
        }
        .status.connected {
            display: block;
            background-color: #d4edda;
            color: #155724;
        }
        .status.error {
            display: block;
            background-color: #f8d7da;
            color: #721c24;
        }
        .tts-stt-controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>AI Interview Simulator</h1>
    <div class="status" id="connection-status">Not connected</div>
    
    <!-- Setup Form -->
    <div class="container" id="setup-form">
        <h2>Start a New Interview</h2>
        <div>
            <label for="job-description">Job Description:</label>
            <textarea id="job-description" rows="5" placeholder="Paste the job description here..."></textarea>
        </div>
        <div>
            <label for="resume">Your Resume:</label>
            <textarea id="resume" rows="5" placeholder="Paste your resume here..."></textarea>
        </div>
        <button id="start-btn">Start Interview</button>
    </div>
    
    <!-- Interview Area -->
    <div class="container interview-area" id="interview-area">
        <h2>Interview in Progress</h2>
        <p>Question <span id="question-number">0</span> of 20</p>
        <div class="question" id="current-question"></div>
        
        <div>
            <label for="answer">Your Answer:</label>
            <textarea id="answer" rows="4" placeholder="Type your answer here..."></textarea>
        </div>
        
        <div class="tts-stt-controls">
            <button id="listen-btn">ðŸŽ¤ Listen for Answer</button>
            <button id="speak-btn">ðŸ”Š Speak Question</button>
        </div>
        
        <div class="controls">
            <button id="submit-btn">Submit Answer</button>
        </div>
    </div>
    
    <!-- Feedback Area -->
    <div class="container feedback-area" id="feedback-area">
        <h2>Interview Feedback</h2>
        <div id="feedback-content"></div>
        <button id="restart-btn">Start New Interview</button>
    </div>
    
    <script>
        // Generate a unique session ID
        const sessionId = 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        let socket;
        
        // DOM Elements
        const setupForm = document.getElementById('setup-form');
        const interviewArea = document.getElementById('interview-area');
        const feedbackArea = document.getElementById('feedback-area');
        const currentQuestion = document.getElementById('current-question');
        const questionNumber = document.getElementById('question-number');
        const answerTextarea = document.getElementById('answer');
        const submitBtn = document.getElementById('submit-btn');
        const startBtn = document.getElementById('start-btn');
        const restartBtn = document.getElementById('restart-btn');
        const jobDescriptionTextarea = document.getElementById('job-description');
        const resumeTextarea = document.getElementById('resume');
        const feedbackContent = document.getElementById('feedback-content');
        const connectionStatus = document.getElementById('connection-status');
        const listenBtn = document.getElementById('listen-btn');
        const speakBtn = document.getElementById('speak-btn');
        
        // Connect to WebSocket server
        function connectToServer() {
            socket = io("http://localhost:5000");
            
            socket.on("connect", () => {
                console.log("Connected to server");
                connectionStatus.textContent = "Connected to server";
                connectionStatus.className = "status connected";
            });
            
            socket.on("disconnect", () => {
                console.log("Disconnected from server");
                connectionStatus.textContent = "Disconnected from server";
                connectionStatus.className = "status error";
            });
            
            socket.on("interview_started", (data) => {
                console.log("Interview started:", data);
                currentQuestion.textContent = data.question;
                questionNumber.textContent = data.question_number;
                
                setupForm.style.display = "none";
                interviewArea.style.display = "block";
                feedbackArea.style.display = "none";
            });
            
            socket.on("next_question", (data) => {
                console.log("Next question:", data);
                currentQuestion.textContent = data.question;
                questionNumber.textContent = data.question_number;
                answerTextarea.value = "";
            });
            
            socket.on("interview_complete", (data) => {
                console.log("Interview complete:", data);
                feedbackContent.innerHTML = formatFeedback(data.feedback.detailed_feedback);
                
                setupForm.style.display = "none";
                interviewArea.style.display = "none";
                feedbackArea.style.display = "block";
            });
            
            socket.on("error", (data) => {
                console.error("Error:", data.message);
                alert("Error: " + data.message);
            });
        }
        
        // Format feedback with some basic HTML
        function formatFeedback(feedback) {
            // Split by headings and format them
            const formattedText = feedback
                .replace(/\n\n/g, '<br><br>')
                .replace(/\n/g, '<br>')
                .replace(/(\d+\. |\* )/g, '<br>$1')
                .replace(/^(.*?:)/gm, '<strong>$1</strong>');
            
            return formattedText;
        }
        
        // Text to Speech Function
        function speakText(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                window.speechSynthesis.cancel(); // Stop any current speech
                window.speechSynthesis.speak(utterance);
            } else {
                alert("Text-to-Speech is not supported in your browser");
            }
        }
        
        // Speech to Text Function
        function listenForSpeech() {
            if ('SpeechRecognition' in window || 'webkitSpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                const recognition = new SpeechRecognition();
                
                recognition.lang = 'en-US';
                recognition.interimResults = false;
                recognition.maxAlternatives = 1;
                
                listenBtn.textContent = "ðŸ”´ Listening...";
                listenBtn.disabled = true;
                
                recognition.start();
                
                recognition.onresult = (event) => {
                    const speechResult = event.results[0][0].transcript;
                    answerTextarea.value = speechResult;
                    console.log('Speech recognized:', speechResult);
                };
                
                recognition.onend = () => {
                    listenBtn.textContent = "ðŸŽ¤ Listen for Answer";
                    listenBtn.disabled = false;
                };
                
                recognition.onerror = (event) => {
                    console.error('Speech recognition error:', event.error);
                    listenBtn.textContent = "ðŸŽ¤ Listen for Answer";
                    listenBtn.disabled = false;
                    alert("Error recognizing speech. Please try again.");
                };
            } else {
                alert("Speech recognition is not supported in your browser");
            }
        }
        
        // Event Listeners
        document.addEventListener('DOMContentLoaded', () => {
            connectToServer();
            
            startBtn.addEventListener('click', () => {
                const jobDescription = jobDescriptionTextarea.value.trim();
                const resume = resumeTextarea.value.trim();
                
                if (!jobDescription || !resume) {
                    alert("Please provide both job description and resume");
                    return;
                }
                
                socket.emit("start_interview", {
                    session_id: sessionId,
                    job_description: jobDescription,
                    resume: resume
                });
            });
            
            submitBtn.addEventListener('click', () => {
                const answer = answerTextarea.value.trim();
                
                if (!answer) {
                    alert("Please provide an answer");
                    return;
                }
                
                socket.emit("submit_answer", {
                    session_id: sessionId,
                    answer: answer
                });
            });
            
            restartBtn.addEventListener('click', () => {
                // Reset the form
                jobDescriptionTextarea.value = "";
                resumeTextarea.value = "";
                answerTextarea.value = "";
                
                // Show setup form
                setupForm.style.display = "block";
                interviewArea.style.display = "none";
                feedbackArea.style.display = "none";
            });
            
            speakBtn.addEventListener('click', () => {
                speakText(currentQuestion.textContent);
            });
            
            listenBtn.addEventListener('click', () => {
                listenForSpeech();
            });
        });
    </script>
</body>
</html>
